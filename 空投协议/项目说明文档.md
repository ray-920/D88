# 项目说明文档

## 文档导航
- [需求文档](需求文档.md)
- [实现文档](实现文档.md)
- [数据同步说明](数据同步说明.md)

## 核心功能导航
### 1. 合约功能
- [D88代币合约](https://dfscan.dragonfly.co/address/0xf37a70365686BF2A1148b692B92773D9F58e365C) - DFC链浏览器
- [D88代币合约代码](contracts/contracts/D88TokenWithReferral.sol) - 合约源码
- [空投合约](https://dfscan.dragonfly.co/address/0x549308FC3FC6dA72C84a85029171A6dd3536279c) - DFC链浏览器
- [空投合约代码](contracts/contracts/D88Airdrop.sol) - 合约源码

### 2. 数据同步
- MongoDB数据模型
- 事件监听脚本
- 增量同步策略

### 3. 查询功能
- 1.88 查询一级推荐人数
- 2.88 查询二级推荐人数
- 10.88 查询系统独立地址数量
- 30.88 刷新合约数据

## 项目概述
本项目是一个基于DFC链的D88代币空投系统，主要功能包括：
1. 用户通过转账特定数量的D88代币进行查询
2. 根据MongoDB中存储的推荐关系进行空投
3. 支持查询推荐人数和系统地址数量
4. 提供合约数据刷新功能

## 技术架构
1. 智能合约层
   - Solidity智能合约
   - OpenZeppelin标准库
   - Web3.js接口

2. 数据层
   - MongoDB存储
   - 事件监听
   - 增量同步

3. 应用层
   - 查询接口
   - 空投计算
   - 数据验证

## 开发工具
1. Truffle - 合约开发框架
2. Web3.js - 区块链交互
3. MongoDB - 数据存储
4. Node.js - 后端服务

## 目录导航
- [项目概述](#项目概述)
- [项目结构](#项目结构)
- [DFC链连接脚本详解](#-dfc链连接脚本详解)
  - [核心配置](#1-核心配置)
  - [主要功能模块](#2-主要功能模块)
    - [DFC链连接](#21-dfc链连接)
    - [合约交互](#22-合约交互)
    - [交易处理](#23-交易处理)
    - [安全机制](#24-安全机制)
  - [使用方法](#3-使用方法)
- [更新日志](#更新日志)
  - [1.0.0](#100---2024-01-12)
  - [1.0.1](#101---2024-01-12)
  - [1.0.2](#102---2024-01-12)
- [注意事项](#注意事项)
- [联系方式](#联系方式)

## 快速链接
- [需求文档](需求文档.md)
- [合约文档](d88合约文档.md)
- [计算文档](计算文档.md)
- [脚本文档](脚本.md)
- [实现文档](实现文档.md)
- [数据同步说明](数据同步说明.md)

## 项目结构
项目根目录/
├── 需求文档.md # 项目需求说明
├── d88合约文档.md # 智能合约文档
├── 计算文档.md # 空投计算逻辑
├── 脚本.md # 事件监听脚本说明
├── 实现文档.md # 项目实现方案
├── 项目说明文档.md # 本文档
├── .env # 环境配置
├── config/
│ ├── connections.js # 连接配置
│ └── abi.json # 合约ABI
└── scripts/
├── testConnection.js # 连接测试脚本
└── DFC连接脚本.js # DFC链连接脚本

## 🔥 DFC链连接脚本详解

### 1. 核心配置

### 2. 主要功能模块

#### 2.1 DFC链连接
- 自动连接DFC链
- 验证网络ID
- 获取实时区块信息
- 监控Gas价格

#### 2.2 合约交互
- 建立合约连接
- 验证合约地址
- 提供合约实例

#### 2.3 交易处理
- 自动构建交易
- 处理交易签名
- 发送交易
- 等待确认

#### 2.4 安全机制
- 区块确认等待
- 失败重试机制
- 错误处理
- 超时控制

### 3. 使用方法

#### 3.1 直接测试

#### 3.2 模块导入

### 1. 相关文档
- [需求文档](需求文档.md)
- [实现文档](实现文档.md)
- [数据同步说明](数据同步说明.md)

### 2. 项目概述
D88空投系统是一个基于DFC链的智能合约系统，用于实现代币空投和用户关系查询功能。系统包括智能合约、数据同步和查询接口三个主要部分。

### 3. 核心功能导航
#### 3.1 合约功能
- [D88代币合约](https://dfscan.dragonfly.co/address/0xf37a70365686BF2A1148b692B92773D9F58e365C) - DFC链浏览器
- [D88代币合约代码](contracts/contracts/D88TokenWithReferral.sol) - 合约源码
- [空投合约](https://dfscan.dragonfly.co/address/0x549308FC3FC6dA72C84a85029171A6dd3536279c) - DFC链浏览器
- [空投合约代码](contracts/contracts/D88Airdrop.sol) - 合约源码

#### 3.2 查询功能
- 一级推荐查询（转入1.88 D88）
- 二级推荐查询（转入2.88 D88）
- 独立地址查询（转入10.88 D88）
- 刷新合约数据（转入30.88 D88）

#### 3.3 数据同步
- MongoDB数据模型
- 事件监听脚本
- 增量同步策略

### 4. 技术架构
- 智能合约：Solidity + OpenZeppelin
- 数据存储：MongoDB
- 区块链交互：Web3.js

### 5. 开发工具
- Truffle：合约开发和测试
- Node.js：脚本开发
- Web3.js：区块链交互

## 项目状态

### 1. 已完成功能
- 智能合约开发与部署
  - [D88代币合约](https://dfscan.dragonfly.co/address/0xf37a70365686BF2A1148b692B92773D9F58e365C)
  - [空投合约](https://dfscan.dragonfly.co/address/0x549308FC3FC6dA72C84a85029171A6dd3536279c)
- 数据同步机制
  - MongoDB数据模型设计
  - 区块链事件监听
  - 增量同步策略实现

### 2. 进行中功能
- 查询接口开发
- 空投计算逻辑优化
- 测试用例编写

### 3. 已知问题
- 空投合约查询返回值计算错误
  - 影响：用户查询推荐人数功能
  - 状态：待修复
  - 解决方案：已制定，详见实现文档